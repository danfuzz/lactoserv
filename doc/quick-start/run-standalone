#!/bin/bash
#
# Copyright 2022-2024 the Lactoserv Authors (Dan Bornstein et alia).
# SPDX-License-Identifier: Apache-2.0

# Figure out the symlink-resolved program name and directory.
cmdName="$(readlink -f "$0")" || exit "$?"
cmdDir="${cmdName%/*}"
cmdName="${cmdName##*/}"

baseDir="$(readlink -f "${cmdDir}/../..")"   # Base directory of this project.
serverBin="${baseDir}/out/lactoserv/bin/run" # Server binary.

if [[ ! -x "${serverBin}" ]]; then
    "${baseDir}/scripts/ubik" build || exit "$?"
    echo ''
fi

"${serverBin}" --config="${cmdDir}/code/config.mjs" --log-to-stdout
